import Foundation

//JSON data:
 /*   URL: https://api.coingecko.com/api/v3/global
 
    JSONResponse:
 {
     "data": {
         "active_cryptocurrencies": 15027,
         "upcoming_icos": 0,
         "ongoing_icos": 49,
         "ended_icos": 3376,
         "markets": 1169,
         "total_market_cap": {
             "btc": 36563547.157625765,
             "eth": 838540109.3260685,
             "ltc": 36244183078.9917,
             "bch": 6379130481.333278,
             "bnb": 4236279071.5864663,
             "eos": 4597626258473.876,
             "xrp": 3849405986344.2817,
             "xlm": 21991887450180.727,
             "link": 211240272449.0293,
             "dot": 473646855021.3268,
             "yfi": 430486932.91804427,
             "usd": 2215768681366.688,
             "aed": 8138518366659.844,
             "ars": 2073213675747223.5,
             "aud": 3369991392483.454,
             "bdt": 260480488220469.03,
             "bhd": 834194808929.6119,
             "bmd": 2215768681366.688,
             "brl": 12200243936473.12,
             "cad": 3048786917126.496,
             "chf": 1919899305112.4753,
             "clp": 2072097652888173.8,
             "cny": 15879749408750.63,
             "czk": 51240093910340.984,
             "dkk": 15146108398350.137,
             "eur": 2028070916368.1162,
             "gbp": 1736836928195.3232,
             "gel": 5960417752876.403,
             "hkd": 17278453388863.371,
             "huf": 800058676624475.8,
             "idr": 3.5341288890930532e+16,
             "ils": 8256793883102.534,
             "inr": 186022311510156.9,
             "jpy": 324973497883964.06,
             "krw": 3024136490546290.5,
             "kwd": 677453548178.4142,
             "lkr": 664051254163838.0,
             "mmk": 4.648682693507302e+15,
             "mxn": 41728242114969.88,
             "myr": 9787050265596.66,
             "ngn": 3454430401725160.5,
             "nok": 23953788906782.72,
             "nzd": 3693256532714.09,
             "php": 126830594889892.03,
             "pkr": 616717553791438.8,
             "pln": 8767532995694.912,
             "rub": 192336844550614.4,
             "sar": 8317127048527.466,
             "sek": 23318084872098.63,
             "sgd": 2932569849788.811,
             "thb": 78025878926465.34,
             "try": 74206093138970.4,
             "twd": 71901693710349.11,
             "uah": 91071895063228.22,
             "vef": 221864918065.24643,
             "vnd": 5.56236865589776e+16,
             "zar": 40603963301813.32,
             "xdr": 1666160554565.771,
             "xag": 80677134784.46791,
             "xau": 911434289.3933744,
             "bits": 36563547157625.766,
             "sats": 3656354715762576.5
         },
         "total_volume": {
             "btc": 860637.9198514582,
             "eth": 19737675.130129904,
             "ltc": 853120683.2133937,
             "bch": 150152871.2257523,
             "bnb": 99714133.10538298,
             "eos": 108219574055.25252,
             "xrp": 90607859966.89435,
             "xlm": 517648142482.90094,
             "link": 4972203268.070259,
             "dot": 11148766346.230223,
             "yfi": 10132862.024371425,
             "usd": 52155075123.9329,
             "aed": 191565590930.20547,
             "ars": 48799595334955.125,
             "aud": 79323331771.96616,
             "bdt": 6131226398180.61,
             "bhd": 19635394837.73338,
             "bmd": 52155075123.9329,
             "brl": 287171059139.88684,
             "cad": 71762775616.77551,
             "chf": 45190860097.70925,
             "clp": 48773326231802.234,
             "cny": 373779776890.6896,
             "czk": 1206096543255.974,
             "dkk": 356511231517.1558,
             "eur": 47737018710.18455,
             "gbp": 40881912101.120186,
             "gel": 140297152083.37976,
             "hkd": 406702668062.67267,
             "huf": 18831893750374.043,
             "idr": 831868232719217.1,
             "ils": 194349576685.2463,
             "inr": 4378619353693.398,
             "jpy": 7649271937976.498,
             "krw": 71182550406021.73,
             "kwd": 15945996978.541498,
             "lkr": 15630531895457.049,
             "mmk": 109421347610010.98,
             "mxn": 982205236763.9507,
             "myr": 230368966822.4116,
             "ngn": 81310869057525.83,
             "nok": 563827655134.7891,
             "nzd": 86932392147.02223,
             "php": 2985356395783.773,
             "pkr": 14516384593179.303,
             "pln": 206371425811.46295,
             "rub": 4527251721262.779,
             "sar": 195769707225.79584,
             "sek": 548864364081.733,
             "sgd": 69027241926.52518,
             "thb": 1836584121457.4146,
             "try": 1746673465900.5132,
             "twd": 1692432187771.6245,
             "uah": 2143663085702.5574,
             "vef": 5222287672.1594,
             "vnd": 1.309278164074509e+15,
             "zar": 955741803801.1472,
             "xdr": 39218321669.89213,
             "xag": 1898989755.046207,
             "xau": 21453468.60147858,
             "bits": 860637919851.4581,
             "sats": 86063791985145.81
         },
         "market_cap_percentage": {
             "btc": 53.9839581616832,
             "eth": 14.335790904002435,
             "usdt": 5.224417137017168,
             "bnb": 3.439465739740393,
             "sol": 3.190790287591024,
             "usdc": 1.5554301609988184,
             "xrp": 1.4573442099487928,
             "steth": 1.1691982218436974,
             "ton": 0.7299031995583316,
             "doge": 0.7010875425950193
         },
         "market_cap_change_percentage_24h_usd": -0.052035296465495755,
         "updated_at": 1723384457
     }
 }
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" } ) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: {$0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: {$0.key == "btc"}) {
            return item.value.asPercentageString()
        }
        return ""
    }
}
